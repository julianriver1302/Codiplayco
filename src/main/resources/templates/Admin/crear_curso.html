<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Curso - CodiPlayCo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link rel="stylesheet" th:href="@{/assetsAdmin/css/panel_codiplay.css}">
    <link rel="stylesheet" th:href="@{/assetsAdmin/css/crear_curso.css}">
    <link th:href="@{/assets/loader.css}" rel="stylesheet" />
</head>

<body>
<div class="admin-container">
    <!-- Animated Background -->
    <div class="bg-element bg-element-1"></div>
    <div class="bg-element bg-element-2"></div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <!-- Logo -->
            <div class="logo-section">
                <div class="logo-icon">
                    <img th:src="@{/assetsAdmin/images/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Logo" />
                </div>
                <div class="logo-text">
                    <h1>CodiPlayCo</h1>
                    <p>Admin Dashboard</p>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <a th:href="@{/PanelCodiplay}" class="nav-tab">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a th:href="@{/PanelCodiplay/Admin/editar_usuarios}" class="nav-tab">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Usuarios</span>
                </a>
                <a th:href="@{/PanelCodiplay/Admin/registrar_docentes}" class="nav-tab">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                        <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                    </svg>
                    <span>Registrar Docentes</span>
                </a>
                <a th:href="@{/PanelCodiplay/Admin/listar_cursos}" class="nav-tab">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                        <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                    </svg>
                    <span>Cursos</span>
                </a>
                <a th:href="@{/PanelCodiplay/Admin/proceso_estudiantes}" class="nav-tab">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    <span>Mensajes</span>
                </a>
            </div>
            
            <!-- Right Actions -->
            <div class="nav-actions">
                <label aria-checked="false" role="switch" class="switch">
                    <input type="checkbox" id="theme-switch" />
                    <span class="slider">
                        <span class="slider-inner"></span>
                    </span>
                </label>
                <div class="user-profile" id="userProfileBtn">
                    <div class="user-avatar">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <div class="user-info">
                        <h3>Admin User</h3>
                        <p>Administrador</p>
                    </div>
                    <i class="fas fa-chevron-down user-profile-arrow"></i>
                    <!-- Menú desplegable -->
                    <div class="user-profile-menu" id="userProfileMenu">
                        <a th:href="@{/logout}" class="user-menu-item">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Cerrar Sesión</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="dashboard-content">
            <div class="page-header-section">
                <button type="button" onclick="window.history.back()" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    <span>Volver</span>
                </button>
                <div class="page-header-title-group">
                    <h1 class="page-main-title">
                        <i class="fas fa-plus-circle"></i> Crear Nuevo Curso
                    </h1>
                    <p class="page-subtitle">Complete todos los campos para crear un nuevo curso educativo</p>
                </div>
            </div>

            <div class="form-container">
                <div class="form-wrapper">
                    <form th:action="@{/PanelCodiplay/Admin/guardar_curso}" method="post" class="course-form">
                        <div class="form-header">
                            <div class="form-icon"><i class="fas fa-book-open"></i></div>
                            <h2>Información del Curso</h2>
                            <p>Complete todos los campos para crear un nuevo curso educativo</p>
                        </div>

                    <div class="form-grid">
                        <!-- Información básica -->
                        <div class="form-group">
                            <label for="curso"><i class="fas fa-graduation-cap"></i> Nombre del Curso *</label>
                            <input type="text" id="curso" name="curso" placeholder="Ej: HTML para Principiantes" required>
                        </div>

                        <div class="form-group">
                            <label for="descripcion"><i class="fas fa-align-left"></i> Descripción *</label>
                            <textarea id="descripcion" name="descripcion" rows="3" required placeholder="Describe brevemente el contenido del curso"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="dirigido"><i class="fas fa-users"></i> Dirigido a *</label>
                            <input type="text" id="dirigido" name="dirigido" placeholder="Ej: Principiantes en programación" required>
                        </div>

                        <!-- Docente -->
                        <div class="form-group">
                            <label for="asignacionDocente"><i class="fas fa-chalkboard-teacher"></i> Docente Asignado *</label>
                            <select id="asignacionDocente" name="asignacionDocente" required>
                                <option value="">Seleccionar docente...</option>
                                <option th:each="asignacion : ${asignaciones}"
                                        th:value="${asignacion.id}"
                                        th:text="${asignacion.usuario.nombre + ' ' + asignacion.usuario.apellido}">
                                </option>
                            </select>
                            <div th:if="${#lists.isEmpty(asignaciones)}" class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>No hay docentes asignados registrados. Primero registra una asignación docente.</span>
                            </div>
                        </div>

                        <!-- Dificultad -->
                        <div class="form-group">
                            <label><i class="fas fa-star"></i> Nivel de Dificultad (1-5)</label>
                            <div class="star-rating-container">
                                <div class="star-rating" id="starRating">
                                    <i class="fas fa-star star" data-rating="1"></i>
                                    <i class="fas fa-star star" data-rating="2"></i>
                                    <i class="fas fa-star star" data-rating="3"></i>
                                    <i class="fas fa-star star" data-rating="4"></i>
                                    <i class="fas fa-star star" data-rating="5"></i>
                                </div>
                                <input type="hidden" id="dificultad" name="dificultad" value="1" required>
                                <span class="difficulty-label" id="difficultyLabel">Principiante</span>
                            </div>
                        </div>

                        <!-- Precio -->
                        <div class="form-group">
                            <label for="precio"><i class="fas fa-dollar-sign"></i> Precio *</label>
                            <div class="price-input-wrapper">
                                <span class="currency-symbol">$</span>
                                <input type="number" id="precio" name="precio" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="window.history.back()" class="btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" class="btn-primary"
                                th:disabled="${#lists.isEmpty(asignaciones)}"
                                th:classappend="${#lists.isEmpty(asignaciones)} ? 'btn-disabled' : ''">
                            <i class="fas fa-plus"></i> Crear Curso
                        </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Scripts -->
<script>
    // Validación de formulario
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.course-form');
        if (form) {
            form.addEventListener('submit', function (e) {
                const requiredFields = this.querySelectorAll('input[required], select[required], textarea[required]');
                let isValid = true;
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('error');
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                    }
                });
                if (!isValid) {
                    e.preventDefault();
                    alert('Por favor, complete todos los campos obligatorios.');
                }
            });

            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('input', () => field.classList.remove('error'));
            });
        }

        // Selector de estrellas de dificultad
        const stars = document.querySelectorAll('.star-rating .star');
        const dificultadInput = document.getElementById('dificultad');
        const difficultyLabel = document.getElementById('difficultyLabel');
        
        const difficultyLabels = {
            1: 'Principiante',
            2: 'Básico',
            3: 'Intermedio',
            4: 'Avanzado',
            5: 'Experto'
        };

        function updateStars(rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            dificultadInput.value = rating;
            difficultyLabel.textContent = difficultyLabels[rating];
        }

        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = parseInt(this.getAttribute('data-rating'));
                updateStars(rating);
            });

            star.addEventListener('mouseenter', function() {
                const rating = parseInt(this.getAttribute('data-rating'));
                stars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.add('hover');
                    } else {
                        s.classList.remove('hover');
                    }
                });
            });
        });

        // Remover hover al salir del contenedor
        const starRatingContainer = document.querySelector('.star-rating');
        if (starRatingContainer) {
            starRatingContainer.addEventListener('mouseleave', function() {
                stars.forEach(star => star.classList.remove('hover'));
            });
        }

        // Inicializar con valor por defecto
        updateStars(1);

        // Set active nav link based on current URL
        const currentPath = window.location.pathname;
        
        // Primero, remover la clase active de TODOS los elementos
        document.querySelectorAll('.nav-tab').forEach(link => {
            link.classList.remove('active');
        });
        
        // Mapeo de rutas relacionadas a sus secciones principales
        const routeMapping = {
            'editar_usuario': '/PanelCodiplay/Admin/editar_usuarios',
            'editar_usuarios': '/PanelCodiplay/Admin/editar_usuarios',
            'registrar_docentes': '/PanelCodiplay/Admin/registrar_docentes',
            'listar_cursos': '/PanelCodiplay/Admin/listar_cursos',
            'editar_curso': '/PanelCodiplay/Admin/listar_cursos',
            'crear_curso': '/PanelCodiplay/Admin/listar_cursos',
            'proceso_estudiantes': '/PanelCodiplay/Admin/proceso_estudiantes',
            'progreso_por_curso': '/PanelCodiplay/Admin/proceso_estudiantes'
        };
        
        // Determinar la ruta objetivo basada en el path actual
        let targetRoute = currentPath;
        
        // Buscar si el path actual contiene alguna de las rutas mapeadas
        for (const [key, route] of Object.entries(routeMapping)) {
            if (currentPath.includes(key)) {
                targetRoute = route;
                break;
            }
        }
        
        // Si estamos en el dashboard exacto, mantenerlo
        if (currentPath === '/PanelCodiplay' || currentPath === '/PanelCodiplay/') {
            targetRoute = '/PanelCodiplay';
        }
        
        // Luego, encontrar la mejor coincidencia
        let bestMatch = null;
        let bestMatchLength = 0;
        
        document.querySelectorAll('.nav-tab').forEach(link => {
            const href = link.getAttribute('href');
            if (href) {
                // Coincidencia exacta tiene prioridad máxima
                if (targetRoute === href || currentPath === href) {
                    bestMatch = link;
                    bestMatchLength = Infinity;
                }
                // Si no hay coincidencia exacta, buscar includes pero priorizar las más largas
                else if (targetRoute.includes(href) && href.length > bestMatchLength) {
                    bestMatch = link;
                    bestMatchLength = href.length;
                }
            }
        });
        
        // Aplicar la clase active solo al mejor match
        if (bestMatch) {
            bestMatch.classList.add('active');
        }

        // Theme Switch
        const themeSwitch = document.getElementById('theme-switch');
        const body = document.body;
        const switchLabel = document.querySelector('.switch');

        // Load saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            body.classList.add('light-theme');
            if (themeSwitch) {
                themeSwitch.checked = true;
            }
            if (switchLabel) {
                switchLabel.setAttribute('aria-checked', 'true');
            }
        } else {
            body.classList.remove('light-theme');
            if (themeSwitch) {
                themeSwitch.checked = false;
            }
            if (switchLabel) {
                switchLabel.setAttribute('aria-checked', 'false');
            }
        }

        // Handle theme switch
        if (themeSwitch) {
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    body.classList.add('light-theme');
                    localStorage.setItem('theme', 'light');
                    if (switchLabel) {
                        switchLabel.setAttribute('aria-checked', 'true');
                    }
                } else {
                    body.classList.remove('light-theme');
                    localStorage.setItem('theme', 'dark');
                    if (switchLabel) {
                        switchLabel.setAttribute('aria-checked', 'false');
                    }
                }
            });
        }

        // User Profile Menu Toggle
        const userProfileBtn = document.getElementById('userProfileBtn');
        const userProfileMenu = document.getElementById('userProfileMenu');
        
        if (userProfileBtn && userProfileMenu) {
            userProfileBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                userProfileBtn.classList.toggle('active');
            });

            // Cerrar el menú al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (!userProfileBtn.contains(e.target)) {
                    userProfileBtn.classList.remove('active');
                }
            });

            // Cerrar el menú al hacer clic en un item del menú
            const menuItems = userProfileMenu.querySelectorAll('.user-menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    userProfileBtn.classList.remove('active');
                });
            });
        }
    });
</script>
</body>
</html>
