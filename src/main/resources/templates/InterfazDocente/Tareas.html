<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title></title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap">
	<link rel="stylesheet" th:href="@{/assetsDocente/stylespanel.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
</head>

<body>
	<nav>
		<div class="nav-logo">
			<img th:src="@{/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Logo" />
		</div>
		<button class="toggle-mode-btn" title="Cambiar modo"
			style="margin:0 auto 0.5rem auto; display:block; background:#fff2; border:none; color:#fff; font-size:1.7rem; border-radius:50%; width:44px; height:44px; box-shadow:0 2px 8px #0002; cursor:pointer; transition:background 0.2s, color 0.2s; display:flex; align-items:center; justify-content:center;"><i
				class="fa-solid fa-moon"></i></button>
		<a th:href="@{/InterfazDocente/paneldocente}"><span class="nav-icon"><i
					class="fa-solid fa-house"></i></span>Inicio</a>
		<a th:href="@{/InterfazDocente/mis-cursos}"><span class="nav-icon"><i class="fa-solid fa-book"></i></span>Mis
			Cursos</a>
		<a th:href="@{/InterfazDocente/tareas}"><span class="nav-icon"><i
					class="fa-solid fa-clipboard-list"></i></span>Tareas</a>
		<a th:href="@{/InterfazDocente/foros}"><span class="nav-icon"><i
					class="fa-solid fa-comments"></i></span>Foros</a>
		<a th:href="@{/InterfazDocente/mensajes}"><span class="nav-icon"><i
					class="fa-solid fa-envelope"></i></span>Mensajes</a>

	</nav>
	<div class="main-layout">
		<header>
			<div class="header-logo-title">
				<h1 class="titulo-blanco"><span class="panel-icon"><i
							class="fa-solid fa-clipboard-list"></i></span>Tareas</h1>
			</div>
			<div class="topbar-right">
				<!-- Botón de modo oscuro eliminado del header -->
				<div class="notificaciones" title="Notificaciones"><i class="fa-solid fa-bell"></i></div>
				<div class="perfil">
					<i class="fa-solid fa-user"></i>
					<span th:if="${docente != null}" th:text="${docente.nombre}">Docente</span>
					<span th:if="${docente == null}">Docente</span>
					<div class="submenu">
						<p th:if="${docente != null}"><strong>Nombre:</strong> <span
								th:text="${docente.nombre + ' ' + docente.apellido}">Nombre Completo</span></p>
						<p th:if="${docente == null}"><strong>Nombre:</strong> No disponible</p>
						<p><strong>Rol:</strong> Docente</p>

						<a th:href="@{/logout}" style="color: inherit; text-decoration: none;">
							<button><i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión</button>
						</a>
					</div>
				</div>
		</header>
		<div class="container">
			<div class="panel" th:if="${cursos == null || #lists.isEmpty(cursos)}">
				<h2><span class="panel-icon"><i class="fa-solid fa-folder-open"></i></span> Tareas / Actividades</h2>
				<p>No tienes cursos asignados, por lo tanto no hay tareas para mostrar.</p>
			</div>

				<div th:each="curso : ${cursos}" class="panel">
					<h2><span class="panel-icon"><i class="fa-solid fa-folder-open"></i></span>
						<span th:text="${curso.curso}">Nombre del curso</span>
					</h2>

				<div th:if="${#maps.containsKey(actividadesPorCurso, curso.id)}">
					<div th:each="act : ${actividadesPorCurso[curso.id]}" class="sub-panel">
						
						<p>
							<strong>Módulo:</strong> 
							<span th:if="${act.modulo != null}">
								<span th:switch="${act.modulo}">
									<span th:case="1">Introducción al Desarrollo Web</span>
									<span th:case="2">Fundamentos de HTML</span>
									<span th:case="3">Estilos con CSS</span>
									<span th:case="4">JavaScript Básico</span>
									<span th:case="5">JavaScript Intermedio</span>
									<span th:case="*">Módulo <span th:text="${act.modulo}"></span></span>
								</span>
							</span>
							<span th:if="${act.modulo == null}">N/A</span>
							&nbsp;|&nbsp;
							<strong>Lección:</strong> 
							<span th:if="${act.leccion != null}">
								<span th:switch="${act.leccion}">
									<span th:case="1">Conceptos básicos</span>
									<span th:case="2">Estructura HTML</span>
									<span th:case="3">Formularios</span>
									<span th:case="4">Tablas</span>
									<span th:case="5">Multimedia</span>
									<span th:case="6">CSS básico</span>
									<span th:case="7">Selectores</span>
									<span th:case="8">Box Model</span>
									<span th:case="9">Flexbox</span>
									<span th:case="10">Grid Layout</span>
									<span th:case="11">JavaScript intro</span>
									<span th:case="12">Variables</span>
									<span th:case="13">Funciones</span>
									<span th:case="14">DOM</span>
									<span th:case="15">Eventos</span>
									<span th:case="*">Lección <span th:text="${act.leccion}"></span></span>
								</span>
							</span>
							<span th:if="${act.leccion == null}">N/A</span>
						</p>
						<p>
							<strong>Fecha:</strong> <span th:text="${act.fecha}"></span>
							&nbsp;|&nbsp;
							<strong>Fecha entrega:</strong> <span th:text="${act.fechaEntrega}"></span>
						</p>

						<table class="tabla-progreso">
							<thead>
								<tr>
									<th>Estudiante</th>
									<th>Estado</th>
									<th>Calificación</th>
									<th>Acciones</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="entrega : ${entregasPorActividad[act.id]}">
									<td
										th:text="${entrega.usuario != null ? entrega.usuario.nombre + ' ' + entrega.usuario.apellido : 'Estudiante'}">
										Nombre estudiante</td>
									<td th:text="${entrega.estado}">Estado</td>
									<td th:text="${entrega.calificacion}">Calificación</td>
									<td>
										<form th:action="@{/InterfazDocente/tareas/calificar}" method="post"
											style="display:inline;">
											<input type="hidden" name="entregaId" th:value="${entrega.id}" />
											<input type="hidden" name="calificacion" value="Aprobado" />
											<button type="submit" name="resultado" value="APROBADO">Aprobar</button>
										</form>
										<form th:action="@{/InterfazDocente/tareas/calificar}" method="post"
											style="display:inline; margin-left:0.5rem;">
											<input type="hidden" name="entregaId" th:value="${entrega.id}" />
											<input type="hidden" name="calificacion" value="No aprobado" />
											<button type="submit" name="resultado" value="NO_APROBADO">No
												aprobar</button>
										</form>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div
					th:if="${!#maps.containsKey(actividadesPorCurso, curso.id) || #lists.isEmpty(actividadesPorCurso[curso.id])}">
					<p>No hay actividades registradas para este curso.</p>
				</div>
			</div>
		</div>
	</div>
	<script>
		// Mantener modo oscuro con localStorage
		function setDarkMode(enabled) {
			if (enabled) {
				document.body.classList.add('dark-mode');
				localStorage.setItem('theme', 'dark-mode');
			} else {
				document.body.classList.remove('dark-mode');
				localStorage.setItem('theme', 'light-mode');
			}
		}
		// Al cargar la página, aplicar preferencia
		(function () {
			const theme = localStorage.getItem('theme');
			if (theme === 'dark-mode') {
				document.body.classList.add('dark-mode');
				const btn = document.querySelector('.toggle-mode-btn');
				if (btn) {
					const icon = btn.querySelector('i');
					icon.classList.remove('fa-moon');
					icon.classList.add('fa-sun');
				}
			}
		})();
		// Alternar icono luna/sol y modo oscuro
		const btn = document.querySelector('.toggle-mode-btn');
		if (btn) btn.addEventListener('click', function () {
			const icon = btn.querySelector('i');
			const isDark = !document.body.classList.contains('dark-mode');
			setDarkMode(isDark);
			if (isDark) {
				icon.classList.remove('fa-moon');
				icon.classList.add('fa-sun');
			} else {
				icon.classList.remove('fa-sun');
				icon.classList.add('fa-moon');
			}
		});
	</script>
</body>

</html>