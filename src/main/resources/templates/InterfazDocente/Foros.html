<!DOCTYPE html>

<html lang="es" xmlns:th="http://thymeLeaf.org">



<head>

	<meta charset="UTF-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<title></title>

	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap">

	<link rel="stylesheet" th:href="@{/assetsDocente/stylespanel.css}">

	<link rel="stylesheet" th:href="@{/assetsDocente/foros.css}">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
	
	<!-- SweetAlert2 -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>



<body>
	<!-- Top Navigation Bar -->
	<nav class="top-nav">
		<div class="top-nav-container">
			<!-- Logo y Brand -->
			<div class="top-nav-brand">
				<div class="top-nav-logo">
					<img th:src="@{/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Mascot" class="top-nav-logo-img" />
				</div>
				<div class="top-nav-brand-text">
					<h1 class="top-nav-brand-title">CodiPlayCo</h1>
					<p class="top-nav-brand-subtitle">Aprende programando</p>
				</div>
			</div>

			<!-- Navigation Links -->
			<div class="top-nav-links">
				<a th:href="@{/InterfazDocente/paneldocente}" class="top-nav-link">
					<i class="fa-solid fa-house"></i>
					<span>Inicio</span>
				</a>
				<a th:href="@{/InterfazDocente/mis-cursos}" class="top-nav-link">
					<i class="fa-solid fa-book"></i>
					<span>Mis Cursos</span>
				</a>
				<a th:href="@{/InterfazDocente/tareas}" class="top-nav-link">
					<i class="fa-solid fa-clipboard-list"></i>
					<span>Tareas</span>
				</a>
			<a th:href="@{/InterfazDocente/foros}" class="top-nav-link active">
				<i class="fa-solid fa-comments"></i>
				<span>Foros</span>
			</a>
			<a th:href="@{/InterfazDocente/mensajes}" class="top-nav-link">
				<i class="fa-solid fa-envelope"></i>
				<span>Mensajes</span>
			</a>
		</div>

			<!-- Right Actions -->
			<div class="top-nav-actions">
				<label aria-checked="false" role="switch" class="switch" title="Cambiar modo claro/oscuro">
					<input type="checkbox" id="themeSwitch" />
					<span class="slider">
						<span class="slider-inner"></span>
					</span>
				</label>
				<div class="top-nav-profile" id="userProfileBtn">
					<div class="top-nav-profile-info">
						<span class="top-nav-profile-name" th:if="${docente != null}" th:text="${docente.nombre}">Docente</span>
						<span class="top-nav-profile-name" th:if="${docente == null}">Docente</span>
						<span class="top-nav-profile-role">Docente</span>
					</div>
					<div class="top-nav-profile-avatar">
						<i class="fa-solid fa-user"></i>
					</div>
					<div class="top-nav-submenu" id="userProfileMenu">
						<div class="submenu-header">
							<p th:if="${docente != null}"><strong>Nombre:</strong> <span th:text="${docente.nombre + ' ' + docente.apellido}">Nombre Completo</span></p>
							<p th:if="${docente == null}"><strong>Nombre:</strong> No disponible</p>
							<p><strong>Rol:</strong> Docente</p>
						</div>
						<div class="submenu-divider"></div>
						<a th:href="@{/InterfazDocente/logout}" class="submenu-logout-btn">
							<i class="fa-solid fa-right-from-bracket"></i>
							<span>Cerrar Sesión</span>
						</a>
					</div>
				</div>
			</div>
		</div>
	</nav>

	<div class="main-layout">
		<header>
			<div class="header-logo-title">
				<h1 class="titulo-blanco"><span class="panel-icon"><i class="fa-solid fa-comments"></i></span>Foros</h1>
			</div>
		</header>

		<div class="container">

			<!-- Success/Error Messages -->
			<div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
			<div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

			<div class="panel">

				<h2><span class="panel-icon"><i class="fa-solid fa-comment-dots"></i></span> Crear Foro</h2>

				<form th:action="@{/InterfazDocente/foros/crear}" method="post" class="form-foro">

					<label for="titulo">Tema:</label>

					<input id="titulo" name="titulo" type="text" placeholder="Ej: Ideas para nuevos juegos" required>

					<label for="cursoId">Curso:</label>

					<select id="cursoId" name="cursoId" required>

						<option value="" disabled selected>Selecciona un curso</option>

						<option th:each="curso : ${cursos}"

						        th:value="${curso.id}"

						        th:text="${curso.curso}">Curso</option>

					</select>

					<label for="descripcion">Descripción:</label>

					<textarea id="descripcion" name="descripcion" rows="3" required></textarea>

					<button type="submit">Crear Foro</button>

				</form>

			</div>



			<div class="panel" th:if="${cursos != null}">

				<h2><span class="panel-icon"><i class="fa-solid fa-list"></i></span> Foros creados</h2>

				<div th:each="curso : ${cursos}" class="foro-curso-bloque">

					<h3 th:text="${curso.curso}">Nombre curso</h3>

					<div th:if="${#maps.containsKey(forosPorCurso, curso.id) and !#lists.isEmpty(forosPorCurso[curso.id])}">

						<ul class="lista-foros">

							<li th:each="foro : ${forosPorCurso[curso.id]}" class="foro-item">

								<div class="foro-header">

									<strong th:text="${foro.titulo}">Título foro</strong>

									<div class="foro-actions">

										<button class="btn-editar" 

												title="Editar foro"

												th:data-id="${foro.id}"

												th:data-titulo="${foro.titulo}"

												th:data-descripcion="${foro.descripcion}">

											<i class="fas fa-edit"></i>

										</button>

										<a th:href="@{/InterfazDocente/foros/detalle(foroId=${foro.id})}"

										   class="btn-ver-respuestas" title="Ver respuestas">

											<i class="fa-solid fa-comments"></i>

											<span th:if="${respuestasPorForo != null and respuestasPorForo.containsKey(foro.id)}" 
												  class="respuesta-count" 
												  th:text="${respuestasPorForo[foro.id]}">0</span>

										</a>

										<form th:action="@{/InterfazDocente/foros/eliminar}"

										      method="post" style="display:inline;"

										      class="form-eliminar-foro">

											<input type="hidden" name="foroId" th:value="${foro.id}" />

											<button type="submit" class="btn-eliminar" title="Eliminar foro">

												<i class="fa-solid fa-trash"></i>

											</button>

										</form>

									</div>

								</div>

								<p th:text="${foro.descripcion}">Descripción</p>

								<small th:text="${#temporals.format(foro.fechaCreacion, 'dd/MM/yyyy HH:mm')}">Fecha</small>

							</li>

						</ul>

					</div>

					<div th:if="${!#maps.containsKey(forosPorCurso, curso.id) || #lists.isEmpty(forosPorCurso[curso.id])}">

						<p>No hay foros para este curso.</p>

					</div>

				</div>

			</div>



			<!-- Modal para editar foro -->

			<div id="editarForoModal" class="modal">

				<div class="modal-content">

					<span class="close-modal">&times;</span>

					<h3>Editar Foro</h3>

					<form th:action="@{/InterfazDocente/foros/editar}" method="post" id="formEditarForo">

						<input type="hidden" id="editarForoId" name="foroId">

						<div class="form-group">

							<label for="editarTitulo">Tema:</label>

							<input type="text" id="editarTitulo" name="titulo" required>

						</div>

						<div class="form-group">

							<label for="editarDescripcion">Descripción:</label>

							<textarea id="editarDescripcion" name="descripcion" rows="3" required></textarea>

						</div>

						<button type="submit" class="btn-guardar">

							<i class="fas fa-save"></i> Guardar Cambios

						</button>

					</form>

				</div>

			</div>

		</div>

	</div>

		<script>
			// Mantener modo oscuro con localStorage
			function setDarkMode(enabled) {
				if (enabled) {
					document.body.classList.add('dark-mode');
					localStorage.setItem('theme', 'dark-mode');
				} else {
					document.body.classList.remove('dark-mode');
					localStorage.setItem('theme', 'light-mode');
				}
			}
			// Al cargar la página, aplicar preferencia
			(function () {
				const theme = localStorage.getItem('theme');
				if (theme === 'dark-mode') {
					document.body.classList.add('dark-mode');
					const btn = document.querySelector('.toggle-mode-btn');
					if (btn) {
						const icon = btn.querySelector('i');
						icon.classList.remove('fa-moon');
						icon.classList.add('fa-sun');
					}
				}
			})();
			// Switch de modo oscuro/claro
			const themeSwitch = document.getElementById('themeSwitch');
			const switchLabel = document.querySelector('.switch');
			
			// Aplicar estado inicial del switch según el tema
			(function () {
				const theme = localStorage.getItem('theme');
				if (theme === 'dark-mode') {
					document.body.classList.add('dark-mode');
					if (themeSwitch) {
						themeSwitch.checked = true;
						if (switchLabel) switchLabel.setAttribute('aria-checked', 'true');
					}
				} else {
					if (themeSwitch) {
						themeSwitch.checked = false;
						if (switchLabel) switchLabel.setAttribute('aria-checked', 'false');
					}
				}
			})();
			
			// Event listener para el switch
			if (themeSwitch) {
				themeSwitch.addEventListener('change', function () {
					const isDark = this.checked;
					setDarkMode(isDark);
					if (switchLabel) {
						switchLabel.setAttribute('aria-checked', isDark ? 'true' : 'false');
					}
				});
			}
			
			// Marcar link activo según la URL
			const currentPath = window.location.pathname;
			const navLinks = document.querySelectorAll('.top-nav-link');
			navLinks.forEach(link => {
				link.classList.remove('active');
				if (link.getAttribute('href') && currentPath.includes(link.getAttribute('href').replace('@{', '').replace('}', ''))) {
					link.classList.add('active');
				}
			});
			
			// User Profile Menu Toggle
			const userProfileBtn = document.getElementById('userProfileBtn');
			const userProfileMenu = document.getElementById('userProfileMenu');
			
			if (userProfileBtn && userProfileMenu) {
				// Toggle menu on click
				userProfileBtn.addEventListener('click', function(e) {
					e.stopPropagation();
					userProfileMenu.classList.toggle('show');
				});
				
				// Close menu when clicking outside
				document.addEventListener('click', function(e) {
					if (!userProfileBtn.contains(e.target) && !userProfileMenu.contains(e.target)) {
						userProfileMenu.classList.remove('show');
					}
				});
				
				// Close menu when clicking on logout button
				const logoutBtn = userProfileMenu.querySelector('.submenu-logout-btn');
				if (logoutBtn) {
					logoutBtn.addEventListener('click', function() {
						userProfileMenu.classList.remove('show');
					});
				}
			}
		</script>



	<!-- Script para el manejo del modal de edición y SweetAlert para eliminar -->

	<script th:inline="javascript">
		// Ruta del logo para usar en SweetAlert
		const logoUrl = /*[[@{/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}]]*/ '/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png';

		document.addEventListener('DOMContentLoaded', function() {

			// SweetAlert para eliminar foro
			document.querySelectorAll('.form-eliminar-foro').forEach(form => {
				form.addEventListener('submit', function(e) {
					e.preventDefault();
					
					const form = this;
					const foroId = form.querySelector('input[name="foroId"]').value;
					const foroTitulo = form.closest('.foro-item').querySelector('.foro-header strong').textContent;
					
					Swal.fire({
						title: '<div class="swal-custom-header"><div class="swal-logo-wrapper"><img src="' + logoUrl + '" class="swal-logo" alt="CodiPlayCo Logo"></div><h2 class="swal-title">Confirmar Eliminación</h2></div>',
						html: `
							<div class="swal-custom-content">
								<div class="swal-icon-wrapper">
									<div class="swal-icon-circle">
										<i class="fas fa-trash-alt swal-warning-icon"></i>
									</div>
								</div>
								<div class="swal-text-content">
									<p class="swal-message">Estás a punto de eliminar el foro:</p>
									<div class="swal-course-badge">
										<i class="fas fa-comments"></i>
										<span class="swal-course-name">${foroTitulo}</span>
									</div>
									<div class="swal-warning-badge">
										<i class="fas fa-exclamation-circle"></i>
										<span>Esta acción no se puede deshacer</span>
									</div>
								</div>
							</div>
						`,
						icon: null,
						showCancelButton: true,
						confirmButtonText: '<i class="fas fa-trash"></i> Sí, eliminar',
						cancelButtonText: '<i class="fas fa-times"></i> Cancelar',
						reverseButtons: true,
						customClass: {
							popup: 'swal2-popup-custom',
							title: 'swal2-title-custom',
							htmlContainer: 'swal2-html-container-custom',
							confirmButton: 'swal2-confirm-custom',
							cancelButton: 'swal2-cancel-custom',
							actions: 'swal2-actions-custom'
						},
						buttonsStyling: true,
						allowOutsideClick: false,
						allowEscapeKey: true,
						showClass: {
							popup: 'swal2-show-custom'
						},
						hideClass: {
							popup: 'swal2-hide-custom'
						}
					}).then((result) => {
						if (result.isConfirmed) {
							// Mostrar loading personalizado mientras se elimina
							Swal.fire({
								title: '<div class="swal-custom-header-loading"><div class="swal-logo-wrapper-small"><img src="' + logoUrl + '" class="swal-logo-small" alt="CodiPlayCo Logo"></div><h2 class="swal-title-loading">Eliminando foro</h2></div>',
								html: '<div class="swal-loading-content"><div class="swal-spinner-wrapper"><div class="swal-spinner"></div></div><p class="swal-loading-text">Procesando tu solicitud...</p></div>',
								icon: null,
								allowOutsideClick: false,
								allowEscapeKey: false,
								showConfirmButton: false,
								customClass: {
									popup: 'swal2-popup-custom swal2-popup-loading',
									htmlContainer: 'swal2-html-container-custom'
								},
								didOpen: () => {
									Swal.showLoading();
								}
							});
							
							// Enviar el formulario
							form.submit();
						}
					});
				});
			});

			const modal = document.getElementById('editarForoModal');

			const closeBtn = document.querySelector('.close-modal');

			const formEditar = document.getElementById('formEditarForo');

			const editarTitulo = document.getElementById('editarTitulo');

			const editarDescripcion = document.getElementById('editarDescripcion');

			const editarForoId = document.getElementById('editarForoId');



			// Abrir modal de edición

			document.querySelectorAll('.btn-editar').forEach(btn => {

				btn.addEventListener('click', function() {

					const foroId = this.getAttribute('data-id');

					const titulo = this.getAttribute('data-titulo');

					const descripcion = this.getAttribute('data-descripcion');



					editarForoId.value = foroId;

					editarTitulo.value = titulo;

					editarDescripcion.value = descripcion;

					modal.style.display = 'block';

				});

			});



			// Cerrar modal

			closeBtn.addEventListener('click', function() {

				modal.style.display = 'none';

			});



			// Cerrar al hacer clic fuera del modal

			window.addEventListener('click', function(event) {

				if (event.target === modal) {

					modal.style.display = 'none';

				}

			});



			// Manejar envío del formulario

			formEditar.addEventListener('submit', function(e) {

				if (!editarTitulo.value.trim() || !editarDescripcion.value.trim()) {

					e.preventDefault();

					alert('Por favor complete todos los campos');

					return false;

				}

				return true;

			});

		});

	</script>

</body>

</html>